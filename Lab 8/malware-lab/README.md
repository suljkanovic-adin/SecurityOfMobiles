# Malware‑Lab – Android Malware Static Scanners

Lab 8 · Security of Mobile Systems · University of Luxembourg

---

## 0. What is this?

A minimal toolkit that flags **ZNIU, ROOTSTV, Slocker and XLoader** malware

families using *static* heuristics only (powered by Androguard). Each run prints

a human‑readable verdict **and** emits a JSON evidence file.

```text
scripts/
├── scan_zniu.py
├── scan_rootstv.py
├── scan_slocker.py
└── scan_xloader.py
```

---

## 1. Setup (≈ 1 minute)

```bash
python3 -m venv .venv            # create virtual env
source .venv/bin/activate        # Windows: .venv\Scripts\activate
pip install -r requirements.txt  # androguard 4.x, rich, pyyaml
```

Make sure the repo root is on  **PYTHONPATH** :

```bash
export PYTHONPATH="$(pwd):$PYTHONPATH"   # put in ~/.bashrc for permanence
```

---

## 2. Folder layout

```text
malware-lab/
│
├── data/               # <‑‑ drop your APKs here
│   └── samples/
├── reports/
│   └── json/           # scanners write .json reports here
├── scripts/            # scanners + shared helpers
└── tests/              # pytest smoke tests
```

---

## 3. Quick start

```bash
# analyse ZNIU sample
python -m scripts.scan_zniu      data/samples/zniu.apk

# other families
python -m scripts.scan_rootstv   data/samples/rootstv.apk
python -m scripts.scan_slocker   data/samples/slocker.apk
python -m scripts.scan_xloader   data/samples/xloader.apk
```

Each command prints a ✅/❌ verdict and writes a timestamped JSON file to

`reports/json/`.

### JSON example

```json
{
  "sample": "xloader.apk",
  "family": "XLOADER",
  "detected": true,
  "evidence": {
    "permissions": ["RECEIVE_SMS"],
    "apis":        ["AccessibilityService"],
    "natives":     [],
    "strings":     ["login"]
  }
}
```

---

## 4. Run the tests

```bash
python -m pytest -q
# → 4 passed in 0.1 s
```

Tests patch Androguard, so they run offline & fast.

---

## 5. Detection logic (very short)

1. **Manifest permissions** – e.g. `BIND_ACCESSIBILITY_SERVICE`
2. **API calls** – e.g. `Runtime.exec("su")`, `Cipher.doFinal`
3. **Native libs** – e.g. `libjni_zniu.so`
4. **Strings** – “bitcoin”, bank domains…

If **≥ 2** categories match the family’s rule, the sample is flagged.

---

## 6. Limitations

* Purely static; heavy obfuscation may hide indicators.
* Multi‑stage downloaders are only caught if stage 1 leaks clues.

Dynamic analysis (Frida / MobSF) would boost confidence.

---
